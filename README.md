# JupiterOne Starbase

Starbase by JupiterOne is an orchestrator application for running graph
ingestion projects and optionally pushing them to a storage endpoint.

<!-- TODO review licensing (matched existing graph-* projects) -->

<!-- TODO use commander for CLI -->

<!-- TODO add functinality to kick off docker Neo4j image. -->

## Development

### Prerequisites

1. Install [Node.js](https://nodejs.org/) using the
   [installer](https://nodejs.org/en/download/) or a version manager such as
   [nvm](https://github.com/nvm-sh/nvm) or [fnm](https://github.com/Schniz/fnm).
2. Install [`yarn`](https://yarnpkg.com/getting-started/install) or
   [`npm`](https://github.com/npm/cli#installation) to install dependencies.
3. Install dependencies with `yarn install`.
4. Register an account in the system each integration targets for ingestion and
   obtain API credentials.
5. `cp config.yaml.example config.yaml` and add necessary values for runtime 
   configuration of each integration as well as any storage endpoint.

   When each integration executes, it needs API credentials and any other
   configuration parameters necessary for its work (provider API credentials,
   data ingestion parameters, etc.). The names of these parameters are defined
   by the `IntegrationInstanceConfigFieldMap`in `src/config.ts` of each
   integration. When the integration is executed, values for these parameters 
   are read from Node's `process.env` by converting config field names to 
   constant case. For example, `clientId` is read from `process.env.CLIENT_ID`.

   The `.env` file is generated by Starbase at runtime based on the values
   provided for each integration in the `config.yaml` file.  For each integration, 
   the `.env` file is then loaded into `process.env` before the integration code 
   is executed.  `.gitignore` is configured to to avoid commiting the `config.yaml`
   and .`.env` files.

### Running the integration

A single call to `yarn ts-node index.ts` will perform the following steps for 
each listed integration in the config.yaml file:
  1. Clone (or pull) the project from Github.
  2. Perform `yarn install` to install all needed dependencies.
  3. Perform `yarn starbase setup` to perform an intial clone of all integrations
     listed in the `config.yaml` file.
  4. Perform `yarn starbase update-integrations` to pull the latest updates and 
     install all dependencies for each integration listed in the `config.yaml` file. 
  4. Perform `yarn starbase run` to collect data for each listed integration and
     then push collected data if a storage endpoint has been listed in `config.yaml`.

### Making Contributions

Start by taking a look at the source code. Each integration is basically a set
of functions called steps, each of which ingests a collection of resources and
relationships. The goal is to limit each step to as few resource types as
possible so that should the ingestion of one type of data fail, it does not
necessarily prevent the ingestion of other, unrelated data. That should be
enough information to allow you to get started coding!

See the
[SDK development documentation](https://github.com/JupiterOne/sdk/blob/main/docs/integrations/development.md)
for a deep dive into the mechanics of how integrations work.

See [docs/development.md](docs/development.md) for any additional details about
developing this integration.

### Changelog

The history of this integration's development can be viewed at
[CHANGELOG.md](CHANGELOG.md).


